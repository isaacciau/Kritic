@page "/projects"
@using Kritik.Shared.Models
@using Kritik.App.Services
@inject ProjectService ProjectService
@inject NavigationManager NavigationManager

@if (isLoading) { <div class="loader text-center mt-5"><div class="spinner-border text-primary" role="status"></div></div> }
else if (projects == null || !projects.Any()) { <p class="empty-state text-center mt-5 text-muted">No hay proyectos activos.</p> }
else
{
    <div class="grid-layout container mt-4">
        <div class="row g-4">
        @foreach (var proj in projects)
        {
            <div class="col-md-6 col-lg-4">
                <div class="project-glass-card p-4 h-100 bg-white shadow-sm rounded-4 position-relative" style="cursor:pointer;" @onclick="() => SeleccionarProyecto(proj.Id!)">
                    <div class="card-status position-absolute top-0 end-0 m-3 badge bg-success rounded-pill">&nbsp;</div>
                    <h3 class="h5 fw-bold mb-2">@proj.TeamName</h3>
                    <p class="desc text-secondary mb-3">@Truncate(proj.Description, 60)</p>
                    <div class="card-bottom d-flex justify-content-between align-items-center mt-auto">
                        <span class="category-tag badge bg-light text-dark rounded-pill px-3 py-2">@proj.Category</span>
                        <button class="btn-icon btn btn-sm btn-primary rounded-circle">âžœ</button>
                    </div>
                </div>
            </div>
        }
        </div>
    </div>
}

@code {
    private List<Project>? projects;
    private bool isLoading = true;
    protected override async Task OnInitializedAsync() {
        try { isLoading = true; projects = await ProjectService.GetProjectsAsync(); }
        catch { } finally { isLoading = false; }
    }
    private void SeleccionarProyecto(string id) => NavigationManager.NavigateTo($"/evaluate/{id}");
    private string Truncate(string val, int max) => val?.Length > max ? val.Substring(0, max) + "..." : val;
}
