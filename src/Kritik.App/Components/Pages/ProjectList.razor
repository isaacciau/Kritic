@page "/projects"
@using Kritik.Shared.Models
@using Kritik.App.Services
@inject ProjectService ProjectService
@inject NavigationManager NavigationManager

<div class="d-flex flex-column h-100">
    <!-- Header -->
    <div class="px-4 pt-4 pb-2 d-flex justify-content-between align-items-center">
        <h2 class="m-0" style="font-size: 1.75rem;">Proyectos</h2>
        <div class="position-relative">
            <i class="bi bi-bell-fill" style="font-size: 1.2rem;"></i>
            <span class="position-absolute top-0 start-100 translate-middle p-1 bg-warning border border-light rounded-circle"></span>
        </div>
    </div>

    <!-- Search -->
    <div class="px-4 py-2 d-flex gap-2">
        <div class="position-relative flex-grow-1">
             <i class="bi bi-search position-absolute text-muted" style="top: 14px; left: 14px;"></i>
             <input type="text" class="input-search" placeholder="Buscar proyecto o tecnologÃ­a..." />
        </div>
        <button class="btn btn-outline-dark d-flex align-items-center justify-content-center" style="width: 48px; border-radius: 12px; border: 2px solid #000;">
            <i class="bi bi-sliders"></i>
        </button>
    </div>

    <!-- Tabs/Pills -->
    <div class="px-4 py-3 d-flex gap-2" style="overflow-x: auto; white-space: nowrap; -ms-overflow-style: none; scrollbar-width: none;">
        <button class="btn btn-dark rounded-pill px-4">Todos</button>
        <button class="btn btn-light border rounded-pill px-4">Pendientes</button>
        <button class="btn btn-light border rounded-pill px-4">Evaluados</button>
        <button class="btn btn-light border rounded-pill px-4">Destacados</button>
    </div>

    <!-- Project List -->
    <div class="px-4 pb-5 flex-grow-1" style="overflow-y: auto;">
        @if (isLoading)
        {
            <div class="text-center mt-5"><div class="spinner-border text-warning" role="status"></div></div>
        }
        else if (projects != null)
        {
            @foreach (var proj in projects)
            {
                <div class="card-modern d-flex flex-column" @onclick="() => SeleccionarProyecto(proj.Id!)" style="cursor: pointer;">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                         <!-- Icon Placeholder -->
                        <div class="d-flex align-items-center justify-content-center rounded-3" style="width: 48px; height: 48px; background-color: #FFF9C4;">
                             <i class="bi bi-box-seam" style="font-size: 1.2rem; color: #FBC02D;"></i>
                        </div>
                        <span class="badge-status badge-pending">
                            <span style="width: 6px; height: 6px; background: #ADB5BD; border-radius: 50%;"></span> Pendiente
                        </span>
                    </div>
                    
                    <h5 class="mb-1" style="font-size: 1.1rem;">@proj.TeamName</h5>
                    <p class="text-muted-small mb-3">Enviado hace 2 horas</p>
                    
                    <div class="d-flex gap-2 flex-wrap">
                        <span class="tech-tag">React</span>
                        <span class="tech-tag">Node.js</span>
                        <span class="tech-tag">MongoDB</span>
                    </div>
                </div>
            }
        }
    </div>

    <!-- Bottom Progress -->
    <div class="p-4 border-top bg-white">
        <div class="d-flex justify-content-between align-items-end mb-2">
            <div>
                <h6 class="m-0 fw-bold">Tu Progreso</h6>
                <small class="text-muted">Meta diaria de evaluaciones</small>
            </div>
            <div class="fs-4 fw-bold">5 <span class="text-muted fs-6 fw-normal">/ 20</span></div>
        </div>
        <div class="progress" style="height: 10px; border-radius: 5px;">
            <div class="progress-bar bg-warning" role="progressbar" style="width: 25%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
        </div>
    </div>
</div>

@code {
    private List<Project>? projects;
    private bool isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        try 
        { 
            isLoading = true; 
            projects = await ProjectService.GetProjectsAsync(); 
        }
        catch { } 
        finally { isLoading = false; }
    }

    private void SeleccionarProyecto(string id) => NavigationManager.NavigateTo($"/evaluate/{id}");
}
